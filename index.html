<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

    <div class="style" id="header">
      <h1>Twittler</h1>
    </div>

    <div id="action">
      <button class="button all">All Tweets</button>
      <button class="button new"></button>
    </div>

    <div class="tweetBox">
      <div id="messages"></div>
    </div>

    <script>

      $(document).ready(function(){

        var displayTweet = function(message){
            var tweet;
            if(message === 'original'){
              tweet = streams.home[index];
            }

            else{

              var tweet = streams.home[streams.home.length - 1];
            }

            var $tweet = $('<div></div>');
            $tweet.addClass('style tweets');
            $tweet.prependTo('#messages');

            var $user = $('<h3 class="user"></h3>');
            $user.text('@' + tweet.user);
            $user.appendTo($tweet);
            $tweet.addClass(tweet.user.toString());

            var $message = $('<p class="message"></p>');
            $message.text(tweet.message);
            $message.appendTo($tweet);

            var $time = $('<p class="time"></p>');
            if(message === 'new'){
              $time.text(date);
            }

            else {
              $time.text(tweet.created_at);
            }

            $time.appendTo($tweet);
        };

        var index = streams.home.length - 1;
        while(index >= 0){
            displayTweet('original');
            index -= 1;
        }

        var $all = $('.all');
        $all.on('click', function(){
          $('.tweets').show();
          /*$('.new').show();*/
        });

        var showTimeline = function(name){
          $('.tweets').hide();
          $(name).show();
          $('.all').show();
        }

        $('#messages').on('click', '.mracus', function(event){
          event.preventDefault();
          showTimeline('.mracus');
        });

        $('#messages').on('click', '.shawndrost', function(event){
          event.preventDefault();
          showTimeline('.shawndrost');
        });

        $('#messages').on('click', '.sharksforcheap', function(event){
          event.preventDefault();
          showTimeline('.sharksforcheap');
        });

        $('#messages').on('click', '.douglascalhoun', function(event){
          event.preventDefault();
          showTimeline('.douglascalhoun');
        });

        // random interval to generate new tweets and placed in container
        // until user clicks to show new tweets
        window.setInterval(function(){
          var incoming = {};
          incoming.tweet = generateRandomTweet;
          incoming.post = displayTweet;
          incoming.timeStamp = new Date;
          container.push(incoming);
          $('.new').show();
          $tweetNumber.text(container.length + ' New Tweets');
        }, Math.random() * 20000)

                var date;

        // to display new tweets

        var container = [];

        if(container.length){
          $('.new').show();
        }

        var $newTweet = $('.new');
        $newTweet.on('click', function(){
          if(container.length){
            for(var i = 0; i < container.length; i++){
              container[i].tweet();
              date = container[i].timeStamp;
              container[i].post('new');
              $('.new').hide();
            }

            container = [];
          }
          $('.tweets').show();
        });

        var $tweetNumber = $('.new');
        $tweetNumber.text(container.length + ' New Tweets');

      });

    </script>
  </body>
</html>
